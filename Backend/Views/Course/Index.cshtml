@using Backend.Models;
@using Newtonsoft.Json;
@model Backend.ViewModels.CourseViewModel
<link rel="stylesheet" type="text/css" href="~/css/Course.css">

@{
    var prevLesHref = $"Course/PrevLesson/{Model.IdCourse}/{Model.CurrentLesson}/{Model.AllLessons.Count}";
    var nextLesHref = $"Course/NextLesson/{Model.IdCourse}/{Model.CurrentLesson}/{Model.AllLessons.Count}";
    ViewBag.Title = "Courses";
    Layout = "CLLayout";
    string header = "";
    object CheckChanged(Answer answer)
    {
        return answer.IsChosen = !answer.IsChosen;
    }
    if (Model.CurrentLesson < Model.AllLessons.Count)
    {
        if (Model.CurrentLesson == 0)
        {
            header = "Введение";
        }
        else
        {
            header = "1." + Model.CurrentLesson;
        }
        <div class="main-container">
            <div class="main-container-cont">
                <div class="Demarcation-line"></div>
                <div class="main-container-list-result">
                    <div class="main-container-list-result-cont">
                        <div class="main-container-list-result-cont-1">@header</div>
                        <div class="main-container-list-result-cont-2">@Model.AllLessons.ElementAt( Model.CurrentLesson).TextContent </div>
                        @if (Model.AllLessons.ElementAt(Model.CurrentLesson).MediaContentPath is not null)
                        {
                            <div class="video-block" src=@Model.AllLessons.ElementAt( Model.CurrentLesson).MediaContentPath></div>
                        }
                        @if (Model.CurrentLesson == 0)
                        {
                            <div class="back-next-btns">
                                <form>
                                    <a class="course-back-button">
                                        <img class="back-button-icon" src="~/pict/left.svg">
                                        <div class="left">Назад</div>
                                    </a>
                                </form>

                                <form method="get" asp-controller="Course" asp-action="NextLesson">
                                    <a class="course-back-button" style="background: #0093DC; font-family: 'Raleway';" href=@nextLesHref>
                                        <div class="next">Дальше</div>
                                        <img class="next-button-icon" src="~/pict/next.svg">
                                    </a>
                                </form>
                            </div>
                        }
                        else if (Model.User.PassedCoursesId is not null)
                        {
                            if (Model.CurrentLesson == Model.AllLessons.Count - 1 && (JsonConvert.DeserializeObject<List<long>>(Model.User.PassedCoursesId).Contains(Model.IdCourse)))
                            {
                                <div class="back-next-btns">
                                    <form method="get" asp-controller="Course" asp-action="PrevLesson">
                                        <a class="course-back-button" style="background: #0093DC;" href=@prevLesHref>
                                            <img class="back-button-icon" src="~/pict/left.svg">
                                            <div class="left">Назад</div>
                                        </a>
                                    </form>

                                    <form>
                                        <a class="course-back-button" style=" font-family: 'Raleway';">
                                            <div class="next">Дальше</div>
                                            <img class="next-button-icon" src="~/pict/next.svg">
                                        </a>
                                    </form>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="back-next-btns">
                                <form method="get" asp-controller="Course" asp-action="PrevLesson">
                                    <a class="course-back-button" style="background: #0093DC;" href=@prevLesHref>
                                        <img class="back-button-icon" src="~/pict/left.svg">
                                        <div class="left">Назад</div>
                                    </a>
                                </form>

                                <form method="get" asp-controller="Course" asp-action="NextLesson">
                                    <a class="course-back-button" style="background: #0093DC; font-family: 'Raleway';" href=@nextLesHref>
                                        <div class="next">Дальше</div>
                                        <img class="next-button-icon" src="~/pict/next.svg">
                                    </a>
                                </form>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    else if (Model.CurrentLesson == Model.AllLessons.Count)
    {
        var hrefcontroller = $"Course/{Model.IdCourse}/SendAllAsync";
        <link rel="stylesheet" type="text/css" href="~/css/Course.css">

        <!--test-->
        <div class="main-container-list-result-5" style="display:block">
            <div class="main-container-list-result-cont-test">
                <div class="main-container-list-result-cont-1">Тест</div>
                @if (Model.Exam is not null && Model.Exam.Questions is not null)
                {
                    <form method="post">
                        <input type="hidden" value="@Model.IdCourse" name="CourseId" />
                        @foreach (var question in Model.Exam.Questions)
                        {
                            @if (question.QuestionType.Equals(Backend.Models.Enum.QuestionType.TextManyAnswers) && question.Answers is not null)
                            {

                                <p class="course-test-que-text">@question.Content</p>
                                @foreach (var answer in question.Answers)
                                {
                                    <div class="test-que">

                                        <input class="test-que-checkbox" type="checkbox" name="SelectedCheckBoxId" value="@answer.Id" id="test-1"@answer.Id>
                                        <label class="course-test-que-text-text">@answer.Content</label>
                                    </div>
                                }

                            }
                            else if (question.QuestionType.Equals(Backend.Models.Enum.QuestionType.TextOneAnswer) && question.Answers is not null)
                            {

                                <p class="course-test-que-text">@question.Content</p>
                                @foreach (var answer in question.Answers)
                                {
                                    <div class="test-que">
                                        <input class="test-que-checkbox" type="radio" name="SelectedRadioId" value="@answer.Id" id="test-1" @answer.Id>
                                        <label class="course-test-que-text-text">@answer.Content</label>
                                    </div>
                                }

                            }
                            else if (question.QuestionType.Equals(Backend.Models.Enum.QuestionType.MediaOneAnswer) && question.Answers is not null)
                            {
                                <p class="course-test-que-text">@question.Content</p>
                                <img class="png-que" src=@question.MediaPath>
                                @foreach (var answer in question.Answers)
                                {
                                    <div class="test-que">
                                        <input class="test-que-checkbox" type="checkbox" name="SelectedCheckBoxId" value="@answer.Id" id="test-1" @answer.Id>
                                        <label class="course-test-que-text-text">@answer.Content</label>
                                    </div>
                                }
                            }
                            else if (question.QuestionType.Equals(Backend.Models.Enum.QuestionType.MediaManyAnswers) && question.Answers is not null)
                            {

                                <p class="course-test-que-text">@question.Content</p>
                                <img class="png-que" src=@question.MediaPath>
                                @foreach (var answer in question.Answers)
                                {
                                    <div class="test-que">
                                        <input class="test-que-checkbox" type="radio" name="SelectedRadioId" value="@answer.Id" id="test-1" @answer.Id>
                                        <label class="course-test-que-text-text">@answer.Content</label>
                                    </div>
                                }

                            }

                        }
                        <button type="submit" class="course-next-button">
                            <div class="log-in-btn">Отправить</div>
                        </button>
                    </form>
                }

            </div>
        </div>
    }
    else
    {
        <!--ending-->
        <div class="main-container-list-result-6">
            <div class="main-container-list-result-cont">
                <p class="sertif-conc">Заключение</p>
                <p class="sertig-gratz">Поздравляем! Вы завершили курс Инвестиции для начинающих</p>
                <img class="sertif-set" src="~/pict/sertif.png">
            </div>
        </div>
    }
}